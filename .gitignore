# =============================================================================
# VOZ SEGURA - GITIGNORE
# =============================================================================
# SEGURIDAD: Nunca subir archivos sensibles al repositorio
# =============================================================================

# Compiled class files
*.class
target/
build/
out/
*.jar
*.war
*.ear

# IDE files
.idea/
*.iml
.vscode/
*.swp
*.swo
.project
.classpath
.settings/
*.code-workspace

# ============================================
# ARCHIVOS SENSIBLES - NUNCA COMMITEAR
# ============================================
# Variables de entorno y secretos
.env
.env.*
.env.local
.env.*.local
*.env

# Archivos de credenciales AWS
.aws/
credentials
*.pem
*.key
*.crt
*_accessKeys.csv
*_credentials.csv
aws-credentials*.csv

# Archivos de configuraci√≥n con secretos
application-local.yml
application-local.properties
application-secrets.yml
Act√∫a como arquitecto de software + auditor de seguridad Zero Trust + senior Spring Boot/Spring Security + auditor de Spring Cloud Gateway. Tengo un proyecto llamado Voz Segura (Java, Spring Boot, Spring Security, Thymeleaf, Spring Cloud Gateway, JPA/Flyway, Postgres/Supabase con schemas: registro_civil, denuncias, evidencias, staff, reglas_derivacion, logs).

Importante

NO cambies la l√≥gica de negocio ni el flujo funcional (roles, pantallas, estados, tracking, derivaci√≥n, OTP, evidencia).

Solo aplica las correcciones listadas abajo.

El ZIP inclu√≠a .env, .git, logs, target solo para que se pueda revisar; NO se publica ni se comparte.

Correcciones obligatorias (solo estas)
1) CERO secretos o claves en repositorio/c√≥digo/config

Debes eliminar/evitar absolutamente cualquier valor sensible en:

c√≥digo Java

application.yml/properties

gateway configs

Dockerfiles / docker-compose

tests / fixtures

documentaci√≥n (README, md)

endpoints de debug

‚úÖ Permitido: variables de entorno, Secrets Manager, o BD cifrada.
üö´ Prohibido: defaults tipo change_me, VOZSEGURA_DATA_KEY_B64 con fallback, JWT secret por defecto, API keys en md.

Resultado: si falta un secreto cr√≠tico, la app debe fallar al iniciar (fail-closed), con un error claro.

2) Cerrar Zero Trust: impedir bypass del Gateway hacia Core

Objetivo: aunque alguien intente acceder al Core directamente, no debe poder autenticarse ni ‚Äúinventar‚Äù headers.

Aplica:

Core no expuesto p√∫blicamente (solo red interna) Y adem√°s:

Implementar verificaci√≥n fuerte de origen Gateway ‚Üí Core (elige una):

mTLS entre Gateway y Core, o

header interno firmado (HMAC) con clave solo en env, o

Core valida tambi√©n JWT (adem√°s del gateway) y rechaza requests sin token v√°lido.

En Core, quitar configuraci√≥n insegura tipo .anyRequest().permitAll() si aplica para rutas sensibles.

No confiar en headers como X-User-Type/X-User-Cedula sin prueba de autenticidad.

3) Eliminar o bloquear endpoints de debug (CR√çTICO)

Eliminar endpoints tipo /health/didit-debug o cualquier endpoint que devuelva config o secretos.

Si existe por necesidad, debe quedar:

solo en perfil dev, y

inaccesible en prod (bloqueado por Spring Security + red).

4) Logs seguros: limpiar y evitar PII/SQL/tokens

Quitar logs innecesarios.

Prohibido loggear:

SQL queries

JWT, OTP

secretos

payloads completos (Didit)

PII (c√©dula completa, nombres)

Ajustar log levels y desactivar debug en prod.

Asegurar que logs/ no se versiona ni se empaqueta.

5) Validaci√≥n de archivos: cerrar bypass (CR√çTICO)

Actualmente hay riesgo si aceptas image/* gen√©rico o conf√≠as en content-type.

Debes:

Aceptar SOLO lista blanca estricta por firma real (magic bytes), no por extension ni content-type:

PDF real

DOCX real (no DOC; rechazar macros)

PNG/JPEG reales (y si aceptas GIF, solo si es necesario)

Si el tipo no est√° en whitelist o no coincide su firma real ‚Üí rechazar.

Poner l√≠mites de tama√±o por tipo y nombre generado por el sistema.

Mantener checksum + almacenamiento cifrado.

6) Reglas de derivaci√≥n: alinear DB ‚Üî entidad ‚Üî UI

Debes corregir inconsistencia entre migraciones y entidades.

Requisitos m√≠nimos:

La regla debe poder matchear:

prioridad (bajo/medio/alto/cr√≠tico)

tipo de denuncia (fraude, acoso, etc.) ‚úÖ obligatorio

(si existe en DB priority_match, debe existir en entidad y viceversa)

Admin define reglas completas (incluyendo tipo).

Analista selecciona par√°metros (incluyendo tipo) sin ver la entidad destino.

Debe calzar 1:1 para que la derivaci√≥n funcione siempre.

Entrega:

Migraci√≥n Flyway (si falta columna) para complaint_type_match (o equivalente).

Ajuste de entidad JPA + repositorio + service + UI.

Tests m√≠nimos para confirmar que reglas se aplican correctamente.

7) Cifrado/anonimizaci√≥n de PII en BD (m√≠nimo en personas y staff)

Objetivo: si alguien accede a la BD, no debe ver PII en claro.

Debes implementar:

Para registro_civil.personas y staff.staff_user (m√≠nimo):

NO guardar c√©dula/nombres/emails en claro (o eliminarlo tras migrar)

Guardar cifrado reversible para lo que necesite recuperaci√≥n (AES-GCM)

Guardar hash determin√≠stico (HMAC con pepper) para b√∫squedas/validaciones

Crear migraci√≥n Flyway que:

agrega columnas *_enc (BYTEA ideal) + *_hash

migra datos existentes (puede ser con job de app si hace falta)

neutraliza/elimina campos en claro

Importante: Nada de base64 como ‚Äúseguridad‚Äù. Si serializas, debe ser por formato, no por ‚Äúocultar‚Äù.

8) Frontend seguro: sin JS/CSS inline, y Thymeleaf sin XSS

No usar <script>...</script> inline ni style="..." (salvo m√≠nimo inevitable).

Separar en /static/js y /static/css.

Evitar th:utext para contenido de usuario.

Sanitizar inputs y escapar outputs.

Entregables (en este orden)

Lista de cambios realizados por severidad (CR√çTICO/ALTO/MEDIO/BAJO)

Cambios exactos por archivo (ruta + qu√© cambiaste)

Parches/snippets listos para pegar (config, security, migraciones, validaci√≥n de archivos)

Checklist de pruebas (bypass core, JWT, OTP, upload malicioso, reglas derivaci√≥n, tracking)

Nota final: qu√© NO pudiste cambiar sin romper l√≥gica (si aplica)
# Archivos de log (pueden contener datos sensibles)
logs/
*.log
*.log.*
*.log.gz
*-secrets.yml
*-secrets.properties

# ============================================
# LOGS Y TEMPORALES
# ============================================
*.log
logs/
*.tmp
*.temp
*.bak
*~

# OS files
.DS_Store
Thumbs.db
Desktop.ini
ehthumbs.db

# Maven wrapper (opcional, algunos proyectos lo incluyen)
!.mvn/wrapper/maven-wrapper.jar
!.mvn/wrapper/maven-wrapper.properties

# Node modules (si usas frontend)
node_modules/
npm-debug.log

# Archivos de error de Windows
nul

# Test reports
surefire-reports/
test-output/
*.exec

# Spring Boot DevTools
.springBeans

# H2 database files
*.db
*.h2.db
