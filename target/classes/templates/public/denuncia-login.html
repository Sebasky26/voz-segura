<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Acceso Seguro - Voz Segura</title>
    <link rel="stylesheet" th:href="@{/css/main.css}" href="/css/main.css"/>
</head>
<body class="vs-app">

    <!-- Modal de T√©rminos y Condiciones -->
    <div class="vs-modal-overlay" id="termsModal">
        <div class="vs-modal">
            <div class="vs-modal__header">
                <h2 class="vs-modal__title">T√©rminos y Condiciones de Uso</h2>
                <button type="button" class="vs-modal__close" onclick="closeTermsModal()" aria-label="Cerrar">&times;</button>
            </div>

            <div class="vs-modal__body">
                <div class="vs-terms">
                    <p><strong>Fecha de vigencia: Enero 2026</strong></p>

                    <h3>1. Aceptaci√≥n de T√©rminos</h3>
                    <p>Al acceder a esta plataforma, usted acepta que:</p>
                    <ul>
                        <li>Todos los datos proporcionados son <strong>leg√≠timos y ver√≠dicos</strong></li>
                        <li>Utilizar√° las evidencias con <strong>responsabilidad</strong> y √∫nicamente para fines leg√≠timos</li>
                        <li>Comprende que el mal uso de esta plataforma est√° sujeto a consecuencias legales</li>
                    </ul>

                    <h3>2. Protecci√≥n de Identidad</h3>
                    <p>Su identidad est√° protegida mediante:</p>
                    <ul>
                        <li><strong>Cifrado de extremo a extremo</strong> (AES-256-GCM)</li>
                        <li><strong>Identity Vault</strong> que separa su identidad de las denuncias</li>
                        <li><strong>Anonimato total</strong> en el proceso de denuncia</li>
                    </ul>

                    <h3>3. Contacto por la Entidad Receptora</h3>
                    <p><strong>IMPORTANTE:</strong> La entidad receptora de la denuncia podr√°, si lo considera necesario, solicitar contacto con el denunciante para:</p>
                    <ul>
                        <li>Ampliar informaci√≥n sobre los hechos denunciados</li>
                        <li>Solicitar evidencias adicionales</li>
                        <li>Realizar seguimiento del caso</li>
                    </ul>
                    <p><strong>Sin embargo, el proceso es totalmente an√≥nimo y nadie sabr√° su identidad real</strong>, a menos que el caso se lleve a instancias legales superiores donde, por orden judicial, sea estrictamente necesario revelar su identidad para garantizar la justicia.</p>

                    <h3>4. Revelaci√≥n Excepcional</h3>
                    <p>Su identidad <strong>SOLO</strong> podr√° ser revelada si:</p>
                    <ul>
                        <li>Existe una <strong>orden judicial</strong> que lo requiera</li>
                        <li>Es estrictamente necesario para la investigaci√≥n de delitos graves</li>
                        <li>El Comit√© de √âtica y Seguridad lo aprueba mediante protocolo especial</li>
                    </ul>
                    <p>En todos los casos, se le notificar√° antes de cualquier revelaci√≥n de identidad.</p>

                    <h3>5. Uso Responsable</h3>
                    <p>Usted se compromete a:</p>
                    <ul>
                        <li>NO realizar denuncias falsas o malintencionadas</li>
                        <li>NO utilizar la plataforma para difamar o perjudicar a terceros</li>
                        <li>Proporcionar evidencias leg√≠timas y obtenidas de manera l√≠cita</li>
                        <li>Colaborar con las autoridades si el caso lo requiere</li>
                    </ul>

                    <h3>6. Confidencialidad de Datos</h3>
                    <p>Todos sus datos personales y evidencias est√°n protegidos por:</p>
                    <ul>
                        <li>Ley de Protecci√≥n de Datos Personales (Ecuador 2026)</li>
                        <li>Normativas internacionales de privacidad (GDPR)</li>
                        <li>Protocolos de seguridad certificados ISO 27001</li>
                    </ul>
                </div>
            </div>

            <div class="vs-modal__footer">
                <button type="button" class="vs-button vs-button--secondary" onclick="closeTermsModal()">
                    <span class="vs-button__icon">‚Üê</span>
                    Volver a leer
                </button>
                <button type="button" class="vs-button vs-button--primary" onclick="acceptTerms()">
                    <span class="vs-button__icon">‚úì</span>
                    Acepto los t√©rminos
                </button>
            </div>
        </div>
    </div>

    <!-- Contenido Principal -->
    <div class="vs-container">
        <header class="vs-header">
            <div class="vs-header__logo">üõ°Ô∏è</div>
        </header>

        <main>
            <div class="vs-card">
                <div class="vs-card__header">
                    <h1 class="vs-card__title">Voz Segura</h1>
                    <p class="vs-card__subtitle">Plataforma Segura de Denuncias An√≥nimas - 2026</p>
                </div>

                <!-- Alerta de Error -->
                <div th:if="${error}" class="vs-alert vs-alert--error">
                    <span class="vs-alert__icon">‚ö†Ô∏è</span>
                    <div>
                        <strong>Error de autenticaci√≥n</strong>
                        <p th:text="${error}">Error al procesar</p>
                    </div>
                </div>

                <!-- Formulario de Login -->
                <form th:action="@{/auth/unified-login}" method="post" th:object="${unifiedLoginForm}" class="vs-form" id="loginForm">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <!-- C√©dula -->
                    <div class="vs-form__group">
                        <label class="vs-form__label vs-form__label--required" for="cedula">
                            C√©dula de Identidad
                        </label>
                        <div class="vs-input-wrapper">
                            <span class="vs-input-icon">üë§</span>
                            <input
                                type="text"
                                th:field="*{cedula}"
                                id="cedula"
                                class="vs-input vs-input--with-icon"
                                placeholder="Ingrese su n√∫mero de c√©dula"
                                required
                                autofocus
                                maxlength="10"
                                pattern="[0-9]{10}"
                            />
                        </div>
                        <span class="vs-form__help">N√∫mero de c√©dula registrado en el Registro Civil del Ecuador</span>
                    </div>

                    <!-- C√≥digo Dactilar -->
                    <div class="vs-form__group">
                        <label class="vs-form__label vs-form__label--required" for="codigoDactilar">
                            C√≥digo Dactilar
                        </label>
                        <div class="vs-input-wrapper">
                            <span class="vs-input-icon">üîí</span>
                            <input
                                type="password"
                                th:field="*{codigoDactilar}"
                                id="codigoDactilar"
                                class="vs-input vs-input--with-icon"
                                placeholder="C√≥digo dactilar de su c√©dula"
                                required
                            />
                        </div>
                        <span class="vs-form__help">C√≥digo dactilar que aparece en su documento de identidad</span>
                    </div>

                    <!-- CAPTCHA -->
                    <div class="vs-form__group">
                        <label class="vs-form__label vs-form__label--required" for="captcha">
                            C√≥digo de Seguridad
                        </label>
                        <div class="vs-captcha">
                            <div class="vs-captcha__code" th:text="${captchaCode}">XXXXXX</div>
                            <input
                                type="text"
                                th:field="*{captcha}"
                                id="captcha"
                                class="vs-input vs-captcha__input"
                                placeholder="Ingrese el c√≥digo"
                                required
                                maxlength="6"
                            />
                        </div>
                        <span class="vs-form__help">Copie exactamente el c√≥digo mostrado para verificar que no es un robot</span>
                    </div>

                    <!-- Divider -->
                    <div class="vs-divider"></div>

                    <!-- Checkbox de t√©rminos -->
                    <label class="vs-checkbox" for="termsAcceptance">
                        <input type="checkbox" class="vs-checkbox__input" id="termsAcceptance" required/>
                        <span class="vs-checkbox__label">
                            <strong>He le√≠do y acepto los T√©rminos y Condiciones.</strong>
                            Comprendo que mis datos son leg√≠timos, que usar√© las evidencias con responsabilidad, y que el proceso es an√≥nimo salvo orden judicial.
                            <a href="#" onclick="showTermsModal(event)" class="vs-link">Leer t√©rminos completos</a>
                        </span>
                    </label>

                    <!-- Bot√≥n Submit -->
                    <button type="submit" class="vs-button vs-button--primary vs-button--block vs-button--lg" id="submitBtn" disabled>
                        <span class="vs-button__icon">‚Üí</span>
                        Iniciar Sesi√≥n Segura
                    </button>
                </form>

                <!-- Aviso de Seguridad -->
                <div class="vs-alert vs-alert--info" style="margin-top: var(--space-6);">
                    <span class="vs-alert__icon">üõ°Ô∏è</span>
                    <div>
                        <strong>Sistema de Autenticaci√≥n Unificado ZTA (Zero Trust Architecture)</strong>
                        <p style="margin-top: var(--space-2); font-size: var(--font-size-xs);">
                            Todos los usuarios son verificados contra el Registro Civil del Ecuador.<br/>
                            El acceso Staff/Admin requiere verificaci√≥n adicional mediante AWS Secrets Manager.<br/>
                            √öltima actualizaci√≥n: Enero 2026
                        </p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
    // Control del modal de t√©rminos
    function showTermsModal(event) {
        if (event) event.preventDefault();
        document.getElementById('termsModal').classList.remove('vs-modal--hidden');
    }

    function closeTermsModal() {
        document.getElementById('termsModal').classList.add('vs-modal--hidden');
    }

    function acceptTerms() {
        document.getElementById('termsAcceptance').checked = true;
        document.getElementById('submitBtn').disabled = false;
        closeTermsModal();
    }

    // Habilitar bot√≥n cuando se aceptan t√©rminos
    document.getElementById('termsAcceptance').addEventListener('change', function() {
        document.getElementById('submitBtn').disabled = !this.checked;
    });

    // Validar formulario antes de enviar
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        const termsAccepted = document.getElementById('termsAcceptance').checked;
        if (!termsAccepted) {
            e.preventDefault();
            alert('Debe aceptar los T√©rminos y Condiciones para continuar');
            return false;
        }
    });

    // Cerrar modal con ESC
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeTermsModal();
        }
    });

    // Cerrar modal al hacer clic fuera
    document.getElementById('termsModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeTermsModal();
        }
    });

    // Mostrar modal al cargar la p√°gina (primera vez)
    window.addEventListener('load', function() {
        const hasSeenTerms = sessionStorage.getItem('termsShown');
        if (!hasSeenTerms) {
            showTermsModal();
            sessionStorage.setItem('termsShown', 'true');
        }
    });

    // Validaci√≥n de c√©dula ecuatoriana
    document.getElementById('cedula').addEventListener('input', function(e) {
        this.value = this.value.replace(/\D/g, '').slice(0, 10);
    });
    </script>
</body>
</html>

