﻿<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Acceso — Voz Segura</title>

    <link rel="stylesheet" th:href="@{/css/main.css?v=5}" href="/css/main.css?v=5"/>

    <!-- Cloudflare Turnstile -->
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>

<body class="vs-app">

<a class="vs-sr-only" href="#contenido">Saltar al contenido</a>

<!-- Modal Términos -->
<div class="vs-modal-overlay vs-modal--hidden" id="termsModal" role="dialog" aria-modal="true" aria-labelledby="termsTitle">
    <div class="vs-modal" role="document">
        <div class="vs-modal__header">
            <h2 class="vs-modal__title" id="termsTitle">Términos y condiciones</h2>
            <button type="button" class="vs-modal__close" data-terms-close aria-label="Cerrar">
                &times;
            </button>
        </div>

        <div class="vs-modal__body">
            <div class="vs-terms">
                <p><strong>Fecha de vigencia: enero 2026</strong></p>

                <h3>Validación de identidad</h3>
                <ul>
                    <li>La identidad se valida para evitar suplantaciones.</li>
                    <li>Los datos se usan solo para este proceso de acceso.</li>
                </ul>

                <h3>Protección de identidad</h3>
                <ul>
                    <li>La identidad del denunciante no se muestra al personal que revisa los casos.</li>
                    <li>Las denuncias y evidencias se almacenan cifradas y se eliminan tras un período de retención definido.</li>
                </ul>

                <h3>Revelación excepcional</h3>
                <ul>
                    <li>La identidad solo podrá revelarse en casos excepcionales y bajo autorización formal de la autoridad competente.</li>
                </ul>

                <h3>Uso responsable</h3>
                <ul>
                    <li>No se permite enviar información falsa o malintencionada.</li>
                    <li>No se permite subir contenido ilegal.</li>
                    <li>Las evidencias deben ser lícitas y pertinentes al caso.</li>
                </ul>

                <h3>Registros y auditoría</h3>
                <ul>
                    <li>Los registros de auditoría no almacenan datos personales del denunciante.</li>
                    <li>Solo se guardan datos mínimos necesarios para trazabilidad del sistema.</li>
                </ul>
            </div>
        </div>

        <div class="vs-modal__footer">
            <button type="button" class="vs-button vs-button--secondary" data-terms-close>
                Cerrar
            </button>
            <button type="button" class="vs-button vs-button--primary" id="acceptTermsBtn">
                Aceptar
            </button>
        </div>
    </div>
</div>

<header class="vs-header">
    <div class="vs-container">
        <div class="vs-brand" aria-label="Voz Segura">
            <img class="vs-brand__logo"
                 th:src="@{/img/logo-voz-segura.svg?v=4}"
                 src="/img/logo-voz-segura.svg?v=4"
                 alt="Logo de Voz Segura">
            <div class="vs-brand__text">
                <div class="vs-brand__title">Voz Segura</div>
                <div class="vs-brand__subtitle">Acceso</div>
            </div>
        </div>
    </div>
</header>

<main id="contenido" class="vs-container">
    <section class="vs-card" aria-labelledby="titulo-acceso">

        <div class="vs-card__header">
            <h1 id="titulo-acceso" class="vs-card__title">Acceso</h1>
            <p class="vs-card__subtitle">Ingresa tus datos para continuar</p>
        </div>

        <!-- Mensaje de sesión expirada -->
        <div th:if="${param.session_expired}" class="vs-alert vs-alert--warning" role="alert" aria-live="polite">
            <div>
                <strong>Sesión cerrada por seguridad</strong>
                <p>Por tu protección, la sesión ha expirado. Por favor, vuelve a ingresar tus datos.</p>
            </div>
        </div>

        <!-- Mensaje de logout exitoso -->
        <div th:if="${param.logout}" class="vs-alert vs-alert--info" role="alert" aria-live="polite">
            <div>
                <strong>Sesión cerrada correctamente</strong>
                <p>Has cerrado sesión de forma segura.</p>
            </div>
        </div>

        <!-- Error backend -->
        <div th:if="${error}" class="vs-alert vs-alert--error" role="alert" aria-live="polite">
            <div>
                <strong>No se pudo completar el acceso</strong>
                <p th:text="${error}">Error al procesar.</p>
            </div>
        </div>

        <!-- Error UI -->
        <div id="uiError" class="vs-alert vs-alert--error vs-hidden" role="alert" aria-live="polite">
            Revisa los campos y completa la verificación de seguridad.
        </div>

        <form th:action="@{/auth/unified-login}"
              method="post"
              th:object="${unifiedLoginForm}"
              class="vs-form"
              id="loginForm"
              novalidate>

            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <!-- Cédula -->
            <div class="vs-form__group">
                <label class="vs-form__label vs-form__label--required" for="cedula">Cédula</label>

                <input type="text"
                       th:field="*{cedula}"
                       id="cedula"
                       class="vs-input"
                       required
                       maxlength="10"
                       inputmode="numeric"
                       autocomplete="off"
                       aria-describedby="cedulaHelp"/>

                <div id="cedulaHelp" class="vs-form__help">
                    Ingresa los 10 dígitos.
                </div>

                <div id="cedulaError" class="vs-form__error vs-hidden" role="alert">
                    La cédula debe tener 10 dígitos.
                </div>
            </div>

            <!-- Código dactilar -->
            <div class="vs-form__group">
                <label class="vs-form__label vs-form__label--required" for="codigoDactilar">Código dactilar</label>

                <input type="text"
                       th:field="*{codigoDactilar}"
                       id="codigoDactilar"
                       class="vs-input"
                       required
                       maxlength="10"
                       placeholder="A1234B5678"
                       autocomplete="off"
                       inputmode="text"
                       aria-describedby="cdHelp cdError"/>

                <div id="cdHelp" class="vs-form__help">
                    Formato: 1 letra + 4 números + 1 letra + 4 números (ej: A1234B5678)
                </div>

                <div id="cdError" class="vs-form__error vs-hidden" role="alert">
                    Formato inválido. Ejemplo válido: A1234B5678
                </div>
            </div>

            <!-- Turnstile -->
            <div class="vs-form__group">
                <label class="vs-form__label vs-form__label--required">Verificación de seguridad</label>

                <div class="cf-turnstile"
                     th:data-sitekey="${turnstileSiteKey}"
                     data-theme="light"
                     data-callback="onTurnstileSuccess"
                     data-expired-callback="onTurnstileExpired"
                     data-error-callback="onTurnstileError"></div>

                <div id="turnstileError" class="vs-form__error vs-hidden" role="alert">
                    No se completó la verificación. Intenta nuevamente.
                </div>
            </div>

            <div class="vs-divider"></div>

            <!-- Términos -->
            <label class="vs-checkbox" for="termsAcceptance">
                <input type="checkbox" class="vs-checkbox__input" id="termsAcceptance" required/>
                <span class="vs-checkbox__label">
          He leído y acepto los términos y condiciones.
          <button type="button" class="vs-link-btn" id="openTermsBtn">Ver términos</button>
        </span>
            </label>

            <button type="submit"
                    class="vs-button vs-button--primary vs-button--block vs-button--lg"
                    id="submitBtn"
                    disabled>
                Iniciar sesión
            </button>
        </form>

        <div class="vs-alert vs-alert--info vs-mt-6">
            <p class="vs-small-muted">
                La información se valida con fuentes oficiales y se gestiona de forma confidencial.
            </p>
        </div>


    </section>
</main>

<script th:src="@{/js/unified-login.js}" src="/js/unified-login.js"></script>
</body>
</html>







