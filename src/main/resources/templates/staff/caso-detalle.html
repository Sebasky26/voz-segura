﻿<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Voz Segura — Detalle de caso</title>

    <link rel="stylesheet" th:href="@{/css/main.css?v=5}" href="/css/main.css?v=5"/>
</head>

<body class="vs-app">

<a class="vs-sr-only" href="#contenido">Saltar al contenido</a>

<header class="vs-header">
    <div class="vs-container vs-container-wide">

        <div class="vs-brand" aria-label="Voz Segura">
            <img class="vs-brand__logo"
                 th:src="@{/img/logo-voz-segura.svg?v=4}"
                 src="/img/logo-voz-segura.svg?v=4"
                 alt="Logo de Voz Segura">
            <div class="vs-brand__text">
                <div class="vs-brand__title">Voz Segura</div>
                <div class="vs-brand__subtitle">Detalle de caso</div>
            </div>
        </div>

        <nav class="vs-nav" aria-label="Navegación">
            <a th:href="@{/staff/casos}" href="/staff/casos" class="vs-nav__link">Casos</a>
            <a th:href="@{/admin/logs}" href="/admin/logs" class="vs-nav__link">Logs</a>
            <a th:href="@{/auth/logout}" href="/auth/logout" class="vs-nav__link">Cerrar sesión</a>
        </nav>

    </div>
</header>

<main id="contenido" class="vs-container vs-container-wide">
    <section class="vs-card" aria-labelledby="titulo-caso">

        <div class="vs-card__header">
            <h1 id="titulo-caso" class="vs-card__title">Detalle de caso</h1>
            <p class="vs-card__subtitle">
                Código de seguimiento:
                <code class="vs-code-pill" th:text="${complaint.trackingId}">ABC-123</code>
            </p>

            <div class="vs-alert vs-alert--info vs-mt-4">
                La identidad del denunciante está protegida y no se muestra en este panel.
            </div>
        </div>

        <!-- Mensajes -->
        <div th:if="${success}" class="vs-alert vs-alert--success" role="status" aria-live="polite" th:text="${success}"></div>
        <div th:if="${error}" class="vs-alert vs-alert--error" role="alert" aria-live="polite" th:text="${error}"></div>

        <!-- Resumen -->
        <div class="vs-grid vs-grid--3cols vs-mb-6" aria-label="Resumen del caso">
            <div class="vs-summary-card">
                <div class="vs-summary-card__label">Estado actual</div>
                <div>
          <span class="vs-badge vs-badge--lg"
                th:classappend="${complaint.status == 'PENDING'} ? ' vs-badge--warning' :
                               (${complaint.status == 'IN_REVIEW'} ? ' vs-badge--info' :
                               (${complaint.status == 'RESOLVED'} ? ' vs-badge--success' :
                               (${complaint.status == 'ARCHIVED'} ? ' vs-badge--secondary' : ' vs-badge--default')))"
                th:text="${complaint.status}">
            PENDING
          </span>
                </div>
            </div>

            <div class="vs-summary-card">
                <div class="vs-summary-card__label">Severidad</div>
                <div>
          <span class="vs-badge vs-badge--lg"
                th:classappend="${complaint.severity == 'CRITICAL'} ? ' vs-badge--danger' :
                               (${complaint.severity == 'HIGH'} ? ' vs-badge--warning' :
                               (${complaint.severity == 'MEDIUM'} ? ' vs-badge--info' : ' vs-badge--default'))"
                th:text="${complaint.severity}">
            MEDIUM
          </span>
                </div>
            </div>

            <div class="vs-summary-card">
                <div class="vs-summary-card__label">Última actualización</div>
                <div class="vs-summary-card__value"
                     th:text="${#temporals.format(complaint.updatedAt, 'dd MMMM yyyy - HH:mm')}">
                    17 enero 2026 - 10:30
                </div>
            </div>
        </div>

        <!-- Empresa -->
        <div class="vs-section vs-mb-6">
            <h3 class="vs-section__title">Empresa denunciada</h3>

            <div class="vs-grid vs-grid--2cols">
                <div class="vs-form__group">
                    <label class="vs-form__label">Nombre</label>
                    <p class="vs-text" th:text="${complaint.companyName}">Empresa XYZ</p>
                </div>

                <div class="vs-form__group">
                    <label class="vs-form__label">Contacto</label>
                    <p class="vs-text" th:text="${complaint.companyContact}">contacto@empresa.com</p>
                </div>

                <div class="vs-form__group vs-grid--full">
                    <label class="vs-form__label">Dirección</label>
                    <p class="vs-text" th:text="${complaint.companyAddress}">Calle Principal 123</p>
                </div>
            </div>
        </div>

        <!-- Fechas -->
        <div class="vs-section vs-mb-6">
            <h3 class="vs-section__title">Fechas</h3>

            <div class="vs-grid vs-grid--2cols">
                <div class="vs-form__group">
                    <label class="vs-form__label">Creación</label>
                    <p class="vs-text" th:text="${#temporals.format(complaint.createdAt, 'dd MMMM yyyy - HH:mm')}">
                        17 enero 2026 - 10:30
                    </p>
                </div>

                <div class="vs-form__group">
                    <label class="vs-form__label">Última actualización</label>
                    <p class="vs-text" th:text="${#temporals.format(complaint.updatedAt, 'dd MMMM yyyy - HH:mm')}">
                        17 enero 2026 - 10:30
                    </p>
                </div>
            </div>
        </div>

        <!-- Contenido -->
        <div class="vs-section vs-mb-6">
            <h3 class="vs-section__title">Contenido de la denuncia</h3>

            <div class="vs-alert vs-alert--warning">
                Información sensible: evita copiar/compartir este contenido fuera del flujo autorizado.
            </div>

            <div class="vs-textarea-readonly" th:text="${decryptedText}">
                Contenido de la denuncia descifrado...
            </div>
        </div>

        <!-- Evidencias (placeholder si no tienes data aún) -->
        <div class="vs-section vs-mb-6">
            <h3 class="vs-section__title">Evidencias</h3>

            <div class="vs-table-wrapper" role="region" aria-label="Tabla de evidencias" tabindex="0">
                <table class="vs-table">
                    <thead>
                    <tr>
                        <th scope="col">Archivo</th>
                        <th scope="col">Tipo</th>
                        <th scope="col">Acción</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="3" class="vs-table-empty">
                            No hay evidencias adjuntas o no están disponibles.
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Acciones -->
        <div class="vs-section">
            <h3 class="vs-section__title">Acciones del caso</h3>

            <div class="vs-grid vs-grid--2cols">

                <!-- Cambiar estado -->
                <form th:action="@{/staff/casos/{id}/estado(id=${complaint.trackingId})}"
                      method="post"
                      class="vs-action-box">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <div class="vs-form__group">
                        <label class="vs-form__label" for="newStatus">Cambiar estado</label>
                        <div class="vs-input-group">
                            <select id="newStatus" name="newStatus" class="vs-select">
                                <option value="PENDING" th:selected="${complaint.status == 'PENDING'}">Pendiente</option>
                                <option value="IN_REVIEW" th:selected="${complaint.status == 'IN_REVIEW'}">En revisión</option>
                                <option value="RESOLVED" th:selected="${complaint.status == 'RESOLVED'}">Resuelto</option>
                                <option value="ARCHIVED" th:selected="${complaint.status == 'ARCHIVED'}">Archivado</option>
                            </select>

                            <button type="submit" class="vs-button vs-button--secondary">
                                Actualizar
                            </button>
                        </div>

                        <div class="vs-form__help">
                            Esta acción queda registrada en auditoría.
                        </div>
                    </div>
                </form>

                <!-- Derivar -->
                <form th:action="@{/staff/casos/{id}/derivar(id=${complaint.trackingId})}"
                      method="post"
                      class="vs-action-box">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <div class="vs-form__group">
                        <label class="vs-form__label" for="destination">Derivar a otra unidad</label>
                        <div class="vs-input-group">
                            <select id="destination" name="destination" class="vs-select">
                                <option value="FISCALIA">Fiscalía General</option>
                                <option value="CONTRALORIA">Contraloría</option>
                                <option value="DEFENSOR_PUEBLO">Defensoría del Pueblo</option>
                                <option value="SUPERINTENDENCIA">Superintendencia de Compañías</option>
                                <option value="MINISTERIO_TRABAJO">Ministerio de Trabajo</option>
                            </select>

                            <button type="submit" class="vs-button vs-button--primary">
                                Derivar
                            </button>
                        </div>

                        <div class="vs-form__help">
                            Deriva solo si corresponde por competencia.
                        </div>
                    </div>
                </form>

            </div>
        </div>

    </section>
</main>

</body>
</html>








